{% extends "main/base.html" %}
{% block title %}Products{% endblock %}
{% block content %}

<div class="flex justify-between items-center mb-10">
  <h1 class="text-3xl font-bold text-pink-500"> Products Overview</h1>
  <a href="{% url 'inventory:product_add' %}" class="bg-pink-400 hover:bg-pink-500 text-white px-5 py-2 rounded-lg shadow transition-all">
    + Add Product
  </a>
</div>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
  <div class="bg-white p-6 rounded-xl shadow hover:shadow-md transition">
    <p class="text-sm text-gray-500">Total Products</p>
    <h2 class="text-3xl font-bold text-pink-400">{{ total_products }}</h2>
  </div>
  <a href="?filter=low" class="bg-white p-6 rounded-xl shadow hover:shadow-md transition">
    <p class="text-sm text-gray-500">Low Stock</p>
    <h2 class="text-3xl font-bold text-red-400">{{ low_stock }}</h2>
  </a>
  <a href="?filter=expiring" class="bg-white p-6 rounded-xl shadow hover:shadow-md transition">
    <p class="text-sm text-gray-500">Expiring Soon</p>
    <h2 class="text-3xl font-bold text-yellow-400">{{ expiring_soon }}</h2>
  </a>
</div>

<!-- newest cards -->
<h2 class="text-2xl font-semibold text-pink-500 mb-4"> Recently Added</h2>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
  {% for product in recent_products %}
  <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition p-6 text-center">
    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="h-24 w-24 mx-auto object-cover rounded mb-3 border">
    <h3 class="font-bold text-lg text-gray-800">{{ product.name }}</h3>
    <p class="text-sm text-gray-500">{{ product.category.name }}</p>
    <p class="text-pink-500 font-semibold mt-1">{{ product.price }} SAR</p>
  </div>
  {% endfor %}
</div>

<!-- Search field -->
<form method="GET" class="flex flex-col sm:flex-row items-center gap-3 mb-10">
  <input type="text" name="q" placeholder="Search by name, category, supplier..." value="{{ request.GET.q }}"
    class="flex-1 p-3 border border-gray-300 rounded-lg w-full sm:w-auto shadow-sm focus:ring-2 focus:ring-pink-300 transition">
  <button type="submit" class="bg-pink-400 hover:bg-pink-500 text-white px-5 py-2 rounded-lg shadow transition">
    Search
  </button>
  <a href="{% url 'inventory:product_list' %}" class="text-sm text-gray-500 hover:underline">Reset</a>
</form>


<div class="overflow-x-auto">
  <table class="w-full bg-white rounded-xl shadow text-left text-sm">
    <thead>
      <tr class="bg-pink-100 text-sm text-gray-700">
        <th class="p-3">Image</th>
        <th class="p-3">Name</th>
        <th class="p-3">Category</th>
        <!-- <th class="p-3">Stock</th> -->
        <th class="p-3">Stock Status</th>
        <th class="p-3">Price</th>
        <th class="p-3">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr class="border-b hover:bg-pink-50">
        <td class="p-3"><img src="{{ product.image.url }}" class="h-10 w-10 rounded object-cover"></td>
        <td class="p-3 font-semibold"><a href="{% url 'inventory:product_detail' product.pk %}" class="text-pink-500 hover:underline">{{ product.name }}</a></td>
        <td class="p-3">{{ product.category.name }}</td>
        <!-- <td class="p-3">{{ product.stock_quantity }}</td> -->
    
        <!-- Stock Status -->
        <td class="p-3">
          {% if product.stock_quantity == 0 %}
            <span class="text-red-500 font-semibold">Out of Stock</span>
          {% elif product.stock_quantity < 10 %}
            <span class="text-yellow-500 font-semibold">Low Stock</span>
          {% else %}
            <span class="text-green-600 font-semibold">In Stock</span>
          {% endif %}
        </td>
    
        <td class="p-3">{{ product.price }} SAR</td>
        <td class="p-3 space-x-2">
          <a href="{% url 'inventory:product_edit' product.pk %}" class="text-blue-500 hover:underline">Edit</a>
          <a href="{% url 'inventory:product_delete' product.pk %}" class="text-red-500 hover:underline">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="p-3 text-center text-gray-400">No products found.</td></tr>
      {% endfor %}
    </tbody>
    
  </table>
</div>

<!-- pagination using paginator -->
<div class="mt-8">
  <div class="flex justify-center items-center gap-2 text-sm">
    {% if products.has_previous %}
      <a href="?page={{ products.previous_page_number }}" class="px-4 py-2 bg-white border rounded hover:bg-pink-100">← Previous</a>
    {% endif %}

    {% for num in products.paginator.page_range %}
      {% if products.number == num %}
        <span class="px-4 py-2 bg-pink-400 text-white rounded shadow">{{ num }}</span>
      {% elif num > products.number|add:"-2" and num < products.number|add:"2" %}
        <a href="?page={{ num }}" class="px-4 py-2 bg-white border rounded hover:bg-pink-100">{{ num }}</a>
      {% endif %}
    {% endfor %}

    {% if products.has_next %}
      <a href="?page={{ products.next_page_number }}" class="px-4 py-2 bg-white border rounded hover:bg-pink-100">Next →</a>
    {% endif %}
  </div>
</div>

{% endblock %}
